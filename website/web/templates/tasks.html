{% extends "base.html" %}
{% from 'bootstrap5/utils.html' import render_icon %}
{% from "macros.html" import display_task_status %}

{% block title %}
    My tasks
{% endblock %}

{% block content %}
  <table id="TasksTable" class="table table-hover table-responsive" style="width:100%"
         data-csrf= {{csrf_token()}}"">
    <thead>
      <tr>
        <th>Id</th>
        <th>Owner</th>
        <th>Date</th>
        <th>Status</th>
        <th>Name</th>
        <th>SHA256</th>
        <th></th>
      </tr>
    </thead>
  </table>
  {% if current_user.is_admin %}
  <script>
      function deleteFile(url, uid) {
          if (! confirm("Are you sure you want to delete this file ? That action is irreversible !")) {
              return false;
          }
          fetch(url, {
            method: "POST",
            headers: {
              "X-CSRF-Token": "{{ csrf_token() }}"
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.success === false) {
              throw new Error(data.error);
            }
            $(`[data-uid=${data.file_id}]`).attr("onclick", "").toggleClass("btn-default btn-danger").html('File deleted');
          })
          .catch((error) => {
            alert("An error has occurred while removing file : " + error);
          });
      };
  </script>
  {% endif %}

{% endblock %}
